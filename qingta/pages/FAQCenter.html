<style>
	.faqItem .fa-minus {
		display:none;
	}
	.faqQuestion {
		cursor: pointer;
	}
	.faqItem.show .faqHide {
		display: block !important;
	}
	.faqItem.show .fa-minus {
		display: inline-block;
	}
	.faqItem.show .fa-plus {
		display: none;
	}

</style>
<div class="changeBarContainer">
	<div class="changeBarBox" style="background-color:#fff;">
		<a class="changeLeft green changeButton" style="width: 100%;border-radius: 6px;text-align: center;padding-left:10px;min-width: 100px;">FAQ</a>
	</div>
	<div class="addDataBtn addDataBtn1" style="margin-right:0;">新增</div>
</div>
<div class="searchBar">
	<div class="commonInputBox">
		<input type="text" placeholder="请输入您要搜索的问题" class="commonput" id="search_faq">
	</div>
	<div class="addDataBtn searchBtn" style="background-color:#3cc">查询</div>
</div>
<div class="enterBox" style="min-height: 400px;border: 2px dashed #ebebeb;margin: 0 20px;width: auto;">
	<div class="faqContent">
	</div>
</div>
<div class="mask"></div>
<div class="unitsChoose">
	<div class="unitsContainer">
		<div class="cancelBtn">
			<i class="fa fa-close showCollege"></i>
		</div>
		<div class="unitsHeader">
			<p class="unitsTitle">FAQ问题管理</p>
		</div>
		<div class="unitsContent unitsContent2">
			<div class="faqEnter">
				<p class="leftItem">问题名称 :</p>
				<div class="commonInputBox rightItem1 rightItem">
					<input class="commonput">
				</div>
				<p class="leftItem leftItem2">问题描述 :</p>
				<div class="commonInputBox  rightItem2 rightItem">
					<textarea class="commontextBox"></textarea>
				</div>
			</div>
			<div class="bottomBtn">
				<p>
					<a class="forSure">确定</a>
					<a class="forConsole">取消</a>
				</p>
			</div>
		</div>
	</div>
</div>
<script type="text/template" id="faq_template">
	<div class="faqItem">
		<div class="faqPlus">
			<i class="fa fa-plus fa-lg faqflag"></i>
			<i class="fa fa-minus fa-lg faqflag"></i>
		</div>
		<span class="faqQuestion"></span>
		<div class="faqHide">
			<p class="faqPara">
			</p>
		</div>
	</div>
</script>
<script type="text/javascript">
	Promise.resolve($.ajax({
		url: '/faq/get',
		type: 'GET'
	})).then(function(res){
		if (res.state == 0) {
			res.faq.forEach(function(faq){
				$(".faqContent").append(generateFAQ(faq.title, faq.text))
			})
		} else {
			alert('获取失败')
		}
	})

	function generateFAQ(question, content){
		var dom = $(faq_template.textContent)
		dom.find('.faqQuestion').text(question)
		dom.find('.faqPara').text(content)
		return dom
	}

	function search(str){
		if (str !== undefined && typeof str == 'string') {search_faq.value = str}
		var search_str = search_faq.value.trim()
		$('.faqItem').each(function(){
			var $this = $(this)
			if ($this.find('.faqQuestion').text().indexOf(search_str) != -1
				|| $this.find('.faqPara').text().indexOf(search_str) != -1) {
				$(this).show()
			} else {
				$(this).hide()
			}
		})
	}

	$('.searchBtn').click(search)
	$(search_faq).keyup(function(e){if (e.keyCode == 13) {search()}})
	$(search_faq).focusout(search)

	$(".addDataBtn1").bind("click",function(){
		$(".unitsContent").find(".commonput").val("");
		$(".unitsContent").find(".commontextBox").val("");
		$(".mask").show();
		popAlertBox(".unitsChoose");
		dragBox(".unitsChoose");
	})

	$(".cancelBtn").bind("click",function(){
		$(".mask").hide();
		$(".unitsChoose").hide();
	})

	$(".faqContent").delegate(".faqPlus, .faqQuestion","click",function(){
		$(this).parents('.faqItem').toggleClass('show')
	})

	$(".forSure").bind("click",function(){
		var que=$(this).parents(".unitsContent").find(".commonput").val();
		var ans=$(this).parents(".unitsContent").find(".commontextBox").val();

		if(que!=""&&ans!=""){
			var dom = generateFAQ(que, ans)

			Promise.resolve($.ajax({
				url: '/faq/edit?title=' + que + '&&text=' + ans 
			})).then(function(res){
				console.dir(res)
			}, function(e){
				console.log(e)
			})

			$(".faqContent").append(dom)
			search('')
		} else {
			alert('未填完数据')
			return
		}

		$(".mask").hide();
		$(".unitsChoose").hide();
	})

	$(".forConsole").bind("click",function(){
		$(this).parents(".unitsContent").find(".commonput").val("");
		$(this).parents(".unitsContent").find(".commontextBox").val("");
	})
</script>