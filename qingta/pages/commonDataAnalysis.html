<link rel="stylesheet" href="../source/css/chart.css">
<div class="changeBarContainer">
	<div class="changeBarBox" style="background-color:#fff;">
		<a class="changeLeft green changeButton" style="width: 100%;border-radius: 6px;text-align: center;padding-left:10px;">中南大学数据分析（测试数据）</a>
	</div>
</div>
<div class="enterBox">
	<div class="topTableBox" style="padding-top:0px;">
		<div class="changeBarContainer" style="border-top:none;">
			<div class="changeBarBox changeBarBox6" style="width:100%;text-align:center;">
				<a class="changeLeft green changeButton">科研数据分析</a>
				<a class="changeLeft changeButton">人才数据分析</a>
				<a class="changeLeft changeButton" href="#/commonDataAnalysisSubject.html?id=11">学科数据分析</a>
				<a class="changeLeft changeButton" href="">奖励数据分析</a>
				<a class="changeLeft changeButton" href="">专利与成果数据分析</a>
				<a class="changeLeft changeButton" href="">经费数据分析</a>
			</div>
		</div>
	</div>
</div>
<div class="tableContent">
	<div class="infoTableBox">
		<div class="infoTableContent"  style="padding-top:10px;">

			<div class="infoTableTop">
				<p class="infoTablePara">
					<span class="topLeft">国家自然科学基金总体情况分析</span>
				</p>
			</div>
			<div class="changeBarContainer" style="border-top:none;text-align:center;">
				<div class="changeBarBox" style="text-align:center;margin-right:0px;float:none;">
					<a class="yellow changeButton changeButtonTab">近十年资助率分析</a>
					<a class="changeButton changeButtonTab">近十年立项数与金额分析</a>
				</div>
			</div>
			<div style="width:100%;height:300px;background:#eee;" id="national_science_total_chart"></div>
			
		</div>
	</div>
</div>

<div class="tableContent">
	<div class="infoTableBox" style="padding-top:0px;">
		<div class="infoTableContent"  style="padding-top:10px;">

			<div class="infoTableTop">
				<p class="infoTablePara">
					<span class="topLeft">国家自然科学基金资助类别分析</span>
				</p>
			</div>
			<div class="changeBarContainer" style="border-top:none;text-align:center;">
				<div class="changeBarBox" style="text-align:center;margin-right:0px;float:none;">
					<a class="yellow changeButton changeButtonTab">近十年资助率分析</a>
					<a class="changeButton changeButtonTab">近十年立项数与金额分析</a>
				</div>
			</div>
			<div style="width:100%;height:300px;background:#eee;" id="national_science_class_chart"></div>
			
		</div>
	</div>
</div>

<div class="tableContent">
	<div class="infoTableBox" style="padding-top:0px;">
		<div class="infoTableContent"  style="padding-top:10px;">

			<div class="infoTableTop">
				<p class="infoTablePara">
					<span class="topLeft">国家自然科学基金学部类型分析</span>
				</p>
			</div>
			<div class="changeBarContainer" style="border-top:none;text-align:center;">
				<div class="changeBarBox" style="text-align:center;margin-right:0px;float:none;">
					<a class="yellow changeButton changeButtonTab">近十年立项数与金额分析</a>
					<a class="changeButton changeButtonTab">立项数占比前五</a>
					<a class="changeButton changeButtonTab">批准金额占比前五</a>
				</div>
			</div>
			<div style="width:100%;height:300px;background:#eee;" id="national_science_department_chart"></div>
			
		</div>
	</div>
</div>

<div class="tableContent">
	<div class="infoTableBox" style="padding-top:0px;">
		<div class="infoTableContent"  style="padding-top:10px;">

			<div class="infoTableTop">
				<p class="infoTablePara">
					<span class="topLeft">国家社科基金立项数分析</span>
				</p>
			</div>
			<div class="changeBarContainer" style="border-top:none;text-align:center;">
				<div class="changeBarBox" style="text-align:center;margin-right:0px;float:none;">
					<a class="yellow changeButton changeButtonTab">近十年立项数分析</a>
				</div>
			</div>
			<div style="width:100%;height:300px;background:#eee;" id="national_social_chart"></div>
			
		</div>
	</div>
</div>

<script type="text/javascript" src="../source/js/utils.js"></script>
<script>
	function getFakeData(){
		return [
			{id:2006, request:500, itemnum:470, money:6800, quantity:1.75},
			{id:2007, request:510, itemnum:480, money:7000, quantity:1.65},
			{id:2008, request:530, itemnum:500, money:7500, quantity:1.76},
			{id:2009, request:540, itemnum:500, money:8000, quantity:1.76},
			{id:2010, request:500, itemnum:470, money:6800, quantity:1.75},
			{id:2011, request:510, itemnum:480, money:7000, quantity:1.65},
			{id:2012, request:530, itemnum:500, money:7500, quantity:1.76},
			{id:2013, request:540, itemnum:500, money:8000, quantity:1.70},
			{id:2014, request:600, itemnum:560, money:9000, quantity:1.85},
			{id:2015, request:620, itemnum:600, money:15000, quantity:1.80}
		]
	}

	function getBaseOption(data){
		return options = {
			legend: {
			     data:['申请数', '立项数', '资助率'],
			     bottom: 'bottom'
			 },
			 toolbox: {
			 	show: true,
			 	feature: {
			 		saveAsImage: {
			 			title: ' '
			 		}
			 	},
			 	left: '40px'
			 },
			 tooptip: {
			 	show: true
			 },
			 grid: {
			     left: '40px',
			     right: '40px',
			     bottom: '40px',
			     top: '40px',
			     containLabel: true
			 },
			 xAxis: {
			     type: 'category',
			     data: data.map(function(item){
			     	return item.id
			     })
			 }
		}
	}
	
	var barColorRequest = 'rgb(0, 188, 212)'
	var barColorItemNum = '#33d5ac'
	var lineColor = 'rgb(255,192,0)'

	function getSetChartOption(){
		return [
		{
			getOption: function(data){
				var baseOption = getBaseOption(data)
				var option = {
					    yAxis: [
						    { 	
						    	position: 'left',
						      	type: 'value' },
							{ 	
								position: 'right',
							  	type: 'value',
							  	splitLine: {
							  		show: false
							  	},
							  	interval: 0.05,
							  	min: data.map(function(item){
							  		return item.quantity
							  	}).sort(function(a, b){ return a - b })[0] - 0.05,
							  	axisLine: {
							  		lineStyle: {
							  			color: '#999'
							  		}	
							  	},
							  	axisLabel: {
							  		formatter: transferPercent
							  	}
							},
					    ],
					    series: [
					        {
					        	yAxisIndex: 0,
					        	name: '申请数',
					            type: 'bar',
					            itemStyle: {
					            	normal: {
					            		color: barColorRequest
					            	}
					            },
					            label: {
					            	normal: {
					            		show: true,
					            		position: 'top',
					            		textStyle: {
					            			color:'#333'
					            		}
					            	}
					            },
					            barGap:'10%',
					            barWidth: 20,
					            data: data.map(function(item){
					            	return item.request
					            })
					        },
					        {
					        	yAxisIndex: 0,
					        	name: '立项数',
					            type: 'bar',
					            itemStyle: {
					            	normal: {
					            		color: barColorItemNum
					            	}
					            },
					            label: {
					            	normal: {
					            		show: true,
					            		position: 'top',
					            		textStyle: {
					            			color:'#333'
					            		}
					            	}
					            },
					            data: data.map(function(item){
					            	return item.itemnum
					            })
					        },
					        {
					        	yAxisIndex: 1,
					        	name: '资助率',
					            type: 'line',
					            symbolSize:1,
					            itemStyle: {
					            	normal: {
					            		color: lineColor
					            	}
					            },
					            label: {
					            	normal: {
					            		show: true,
					            		position: 'top',
					            		textStyle: {
					            			color:'#333'
					            		},
					            		formatter: function(item) {
					            			console.log(transferPercent(item.data))
					            			return transferPercent(item.data)
					            		}
					            	}
					            },
					           	lineStyle: {
					           		normal: {
					           			color: lineColor,
					           			width: 3
					           		}
					           	},
					            data: data.map(function(item){
					            	return item.quantity
					            }),
					            z:3
					        }
					    ]
					}
				return $.extend({}, baseOption, option)
			},
			getData: getFakeData
		},
		{
			getOption: function(data){
				var baseOption = getBaseOption(data)
				baseOption.legend.data = ['立项数', '批准金额']
				var option = {
					    yAxis: [
						    { 	
						    	position: 'left',
						      	type: 'value' },
							{ 	
								position: 'right',
							  	type: 'value',
							  	splitLine: {
							  		show: false
							  	},
							  	max: data.map(function(item){
							  		return item.money
							  	}).sort(function(a,b){return a - b}).pop() + 1000,
							  	interval: 2000,
							  	axisLine: {
							  		lineStyle: {
							  			color: '#999'
							  		}	
							  	}
							},
					    ],
					    series: [
					        {
					        	yAxisIndex: 0,
					        	name: '立项数',
					            type: 'bar',
					            itemStyle: {
					            	normal: {
					            		color: barColorRequest
					            	}
					            },
					            label: {
					            	normal: {
					            		show: true,
					            		position: 'top',
					            		textStyle: {
					            			color:'#333'
					            		}
					            	}
					            },
					            barWidth: 30,
					            data: data.map(function(item){
					            	return item.itemnum
					            })
					        },
					        {
					        	yAxisIndex: 1,
					        	name: '批准金额',
					            type: 'line',
					            symbolSize:1,
					            itemStyle: {
					            	normal: {
					            		color: lineColor
					            	}
					            },
					            label: {
					            	normal: {
					            		show: true,
					            		position: 'top',
					            		textStyle: {
					            			color:'#333'
					            		}
					            	}
					            },
					           	lineStyle: {
					           		normal: {
					           			color: lineColor,
					           			width: 3
					           		}
					           	},
					            data: data.map(function(item){
					            	return item.money
					            }),
					            z:3
					        }
					    ]
					}
				return $.extend({}, baseOption, option)
			},
			getData: getFakeData
		}]
	}
	setChart(national_science_total_chart, getSetChartOption())

	setChart(national_science_class_chart, getSetChartOption())


	setChart(national_science_department_chart, [getSetChartOption()[1], {
		getOption: function(data){
			return {

			}
		},
		getData: function(){
			return {

			}
		}
	}])


	function getSocialData(){
			var fakeData = []
			var max = 0
			for (var i = 2006; i < 2016; i++) {
				var quantity = Math.random() * 400 | 0
				if (quantity > max) {
					max = quantity
				}
				fakeData.push({
					id: i,
					value: quantity
				})
			}
			return {max: max, data: fakeData}
		}

	function getSocialOption(data){
		var lineColor = 'rgb(51,204,204)'
		var lineWidth = 3
		return optionQuantity = {
			title: {
				show:false
			},
			grid: {
				containLabel: true,
				left: 0,
				right: 0,
				top: '40px',
				bottom: '20px'
			},
	        legend: {
	            data:['销量']
	        },
	        xAxis:  {
	            type: 'category',
	            axisLabel: {
	            	interval: 0,
	            	textStyle: {
	            		color: '#333'
	            	}
	            },
	            axisTick: {
	            	show: false
	            },
	            axisLine: {
	            	lineStyle: {
	            		color: lineColor,
	            		width: 3
	            	}
	            },
	            data: data.map(function(item){
	            	return item.id + '年'
	            })
	        },
	        yAxis: {
	            type: 'value',
	            interval: 50,
	            axisLine: {
	            	show: false
	            },
	            axisTick: {
	            	show: false
	            },
	            splitLine: {
	            	lineStyle: {
	            		color: '#eee'
	            	}
	            }
	        },
	        series: [
	        	{
		            type:'line',
		            data:data.map(function(item) {return item.value}),
		            symbolSize: 16,
		            label: {
		            	normal: {
		            		show: true,
		            		position: 'top',
		            		textStyle: {
		            			color: '#666'
		            		}
		            	}
		            },
		            itemStyle: {
		            	normal: {
		            		borderColor: lineColor,
		            		borderWidth: lineWidth
		            	}
		            },
		            lineStyle: {
		            	normal: {
		            		color: lineColor,
		            		width: lineWidth
		            	}
		            }
		        }
	        ]
	    }
	}

	setChart(national_social_chart, [{
		getOption:getSocialOption,
		getData: function(){return getSocialData().data}
	}])
</script>